<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro de Candidato — MAXISEGURIDAD</title>
  <style>
    body {
      background: #f4f5f7;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      color: #333;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .container {
      background-color: #ffffff;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      max-width: 600px;
      width: 100%;
    }
    h2 {
      color: #004c7f;
      font-weight: 600;
      text-align: center;
      margin-bottom: 1.5rem;
    }
    .form-group {
      margin-bottom: 1rem;
    }
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: bold;
    }
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .form-group input[type="file"] {
      padding: 0.3rem;
    }
    .btn {
      display: block;
      width: 100%;
      padding: 0.75rem;
      border: none;
      border-radius: 4px;
      background-color: #004c7f;
      color: #fff;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 1rem;
    }
    .btn:hover {
      background-color: #0063aa;
    }
    .thanks-message {
      text-align: center;
      color: #28a745;
      font-weight: bold;
      margin-top: 2rem;
    }
    .d-none {
      display: none !important;
    }
  </style>
</head>
<body>

<div class="container" id="formContainer">
  <h2>Registro de Candidato — MAXISEGURIDAD</h2>
  <form id="cvForm">
    <input type="hidden" name="ItemType" value="RegistroCV">

    <div class="form-group">
      <label>Nombre y Apellido</label>
      <input name="NombreApellido" class="form-control" required>
    </div>

    <div class="form-group">
      <label>Correo Electrónico</label>
      <input name="CorreoElectronico" type="email" class="form-control" required>
    </div>

    <div class="form-group">
      <label>Celular</label>
      <input name="Celular" type="text" class="form-control" required>
    </div>

    <div class="form-group">
      <label>¿Estás cursando una carrera universitaria?</label>
      <select name="EstudiaUni" id="EstudiaUni" class="form-control" required>
        <option value="">Seleccione…</option>
        <option>Sí</option>
        <option>No</option>
      </select>
    </div>

    <div class="form-group d-none" id="divCarrera">
      <label>Carrera Universitaria</label>
      <input name="carreraUniversitaria" class="form-control">
    </div>
    <div class="form-group d-none" id="divUni">
      <label>Universidad</label>
      <input name="Universidad" class="form-control">
    </div>

    <div class="form-group">
      <label>Área deseada</label>
      <select name="GustariaTrabajar" class="form-control" required>
        <option value="">Seleccione…</option>
        <option>Obras</option>
        <option>Ingeniería</option>
        <option>Taller</option>
        <option>Logística</option>
        <option>Comercial</option>
        <option>Compras</option>
        <option>Administración y finanzas</option>
        <option>Facturación</option>
        <option>Recursos Humanos</option>
        <option>Marketing</option>
      </select>
    </div>

    <div class="form-group">
      <label>Puesto al que postulas</label>
      <input name="PuestoPostulas" class="form-control" required>
    </div>

    <div class="form-group">
      <label>Localidad de Residencia</label>
      <input name="LocalidadResidencia" class="form-control" required>
    </div>

    <div class="form-row">
      <div class="form-group col">
        <label>Graduado ET?</label>
        <select name="GraduadoET" id="GraduadoET" class="form-control" required>
          <option value="">Seleccione…</option>
          <option>Sí</option>
          <option>No</option>
        </select>
      </div>
      <div class="form-group col d-none" id="colEscuela">
        <label>Escuela Técnica</label>
        <input name="EscuelaTecnica" class="form-control">
      </div>
    </div>

    <div class="form-group">
      <label>Remuneración Pretendida (neto)</label>
      <input name="RemuneracionPretendida" class="form-control">
    </div>

    <div class="form-group">
      <label>Adjuntar CV (PDF)</label>
      <input type="file" id="cvFile" class="form-control-file" accept=".pdf">
    </div>

    <button type="submit" class="btn">Enviar Registro</button>
  </form>
</div>

<script>
const divCarrera = document.getElementById('divCarrera');
const divUni = document.getElementById('divUni');
const selEstudiaUni = document.getElementById('EstudiaUni');
selEstudiaUni.addEventListener('change', () => {
  if (selEstudiaUni.value === 'Sí') {
    divCarrera.classList.remove('d-none');
    divCarrera.querySelector('input').required = true;
    divUni.classList.remove('d-none');
    divUni.querySelector('input').required = true;
  } else {
    divCarrera.classList.add('d-none');
    divCarrera.querySelector('input').required = false;
    divCarrera.querySelector('input').value = '';
    divUni.classList.add('d-none');
    divUni.querySelector('input').required = false;
    divUni.querySelector('input').value = '';
  }
});

const colEscuela = document.getElementById('colEscuela');
const selGraduadoET = document.getElementById('GraduadoET');
const inputEscuela = colEscuela.querySelector('input[name="EscuelaTecnica"]');
selGraduadoET.addEventListener('change', () => {
  if (selGraduadoET.value === 'Sí') {
    colEscuela.classList.remove('d-none');
    inputEscuela.required = true;
  } else {
    colEscuela.classList.add('d-none');
    inputEscuela.required = false;
    inputEscuela.value = '';
  }
});

async function fileToBase64(file) {
  return new Promise((res, rej) => {
    const reader = new FileReader();
    reader.onload = () => res(reader.result.split(',')[1]);
    reader.onerror = rej;
    reader.readAsDataURL(file);
  });
}

document.getElementById('cvForm').addEventListener('submit', async e => {
  e.preventDefault();

  const formData = new FormData(e.target);
  const data = Object.fromEntries(formData);

  if (document.getElementById('cvFile').files.length > 0) {
    const file = document.getElementById('cvFile').files[0];
    data.CvDrive = await fileToBase64(file);
  }

  const resp = await fetch(
    'https://prod-07.westus.logic.azure.com:443/workflows/7ab75adb4f8f48efb50d62e532ea976d/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=zEuVzFC072quIP3pByqBZiFEo29HNimJY1l6jW2iu4E', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    }
  );

  const text = await resp.text();
  const container = document.getElementById('formContainer');

  if (!resp.ok) {
    container.innerHTML = `<h2>Error ${resp.status}: ${text}</h2>`;
    console.error('Response body:', text);
  } else {
    container.innerHTML = `<h2 class="thanks-message">Gracias por enviar tu registro</h2>`;
    setTimeout(() => {
      location.reload();
    }, 3000);
  }
});
</script>
</body>
</html>
